
<!doctype html>
<html class="no-js" lang="zxx">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Dashboard - JOEeXPRESS</title>

<link href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<link rel="stylesheet" href="css/icofont.css">
<link rel="stylesheet" href="css/normalize.css">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="css/responsive.css">

<!-- Supabase -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<!-- Chart.js for analytics -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
    --primary-color: #007bff;
    --secondary-color: #6c757d;
    --success-color: #28a745;
    --warning-color: #ffc107;
    --danger-color: #dc3545;
    --info-color: #17a2b8;
    --dark-color: #343a40;
    --light-color: #f8f9fa;
    --border-radius: 12px;
    --box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

body {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    font-family: 'Poppins', sans-serif;
}

.dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

.dashboard-header {
    background: white;
    border-radius: var(--border-radius);
    padding: 20px 30px;
    margin-bottom: 30px;
    box-shadow: var(--box-shadow);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
}

.user-welcome h2 {
    margin: 0;
    color: var(--dark-color);
    font-weight: 600;
}

.user-welcome p {
    margin: 5px 0 0 0;
    color: var(--secondary-color);
}

.header-actions {
    display: flex;
    gap: 15px;
    align-items: center;
}

.notification-bell {
    position: relative;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    cursor: pointer;
    font-size: 18px;
    transition: all 0.3s;
}

.notification-bell:hover {
    transform: scale(1.1);
    background: #0056b3;
}

.notification-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: var(--danger-color);
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.logout-btn {
    background: var(--danger-color);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s;
}

.logout-btn:hover {
    background: #c82333;
    transform: translateY(-2px);
}

.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
}

.dashboard-card {
    background: white;
    border-radius: var(--border-radius);
    padding: 25px;
    box-shadow: var(--box-shadow);
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
}

.dashboard-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.15);
}

.dashboard-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(45deg, var(--primary-color), var(--info-color));
}

.card-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 20px;
}

.card-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--dark-color);
    margin: 0;
}

.card-icon {
    background: linear-gradient(45deg, var(--primary-color), var(--info-color));
    color: white;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.stat-item {
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border-radius: var(--border-radius);
    transition: all 0.3s;
}

.stat-item:hover {
    transform: scale(1.05);
}

.stat-value {
    font-size: 28px;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 5px;
}

.stat-label {
    color: var(--secondary-color);
    font-size: 14px;
    font-weight: 500;
}

.progress-item {
    margin-bottom: 20px;
}

.progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.progress-label {
    font-weight: 500;
    color: var(--dark-color);
}

.progress-percentage {
    font-size: 14px;
    color: var(--primary-color);
    font-weight: 600;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(45deg, var(--primary-color), var(--success-color));
    transition: width 1s ease-in-out;
    border-radius: 4px;
}

.activity-item {
    display: flex;
    align-items: center;
    padding: 15px 0;
    border-bottom: 1px solid #e9ecef;
}

.activity-item:last-child {
    border-bottom: none;
}

.activity-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    font-size: 16px;
    color: white;
}

.activity-content {
    flex: 1;
}

.activity-title {
    font-weight: 500;
    color: var(--dark-color);
    margin-bottom: 5px;
}

.activity-time {
    font-size: 12px;
    color: var(--secondary-color);
}

.achievement-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 15px;
}

.achievement-badge {
    text-align: center;
    padding: 20px 10px;
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    border-radius: var(--border-radius);
    transition: all 0.3s;
    cursor: pointer;
}

.achievement-badge:hover {
    transform: scale(1.05);
}

.achievement-badge.locked {
    background: #e9ecef;
    opacity: 0.6;
}

.achievement-icon {
    font-size: 24px;
    margin-bottom: 10px;
}

.achievement-name {
    font-size: 12px;
    font-weight: 500;
    color: var(--dark-color);
}

.quick-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
}

.action-btn {
    padding: 15px;
    background: linear-gradient(45deg, var(--primary-color), var(--info-color));
    color: white;
    border: none;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s;
    text-align: center;
}

.action-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 20px rgba(0,123,255,0.3);
}

.calendar-widget {
    background: white;
    border-radius: var(--border-radius);
    padding: 20px;
    box-shadow: var(--box-shadow);
}

.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.calendar-nav {
    background: none;
    border: none;
    font-size: 18px;
    cursor: pointer;
    color: var(--primary-color);
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
}

.calendar-day {
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
}

.calendar-day:hover {
    background: var(--light-color);
}

.calendar-day.today {
    background: var(--primary-color);
    color: white;
}

.calendar-day.has-event {
    background: var(--warning-color);
    color: var(--dark-color);
}

.event-item {
    padding: 10px;
    background: var(--light-color);
    border-radius: var(--border-radius);
    margin-bottom: 10px;
}

.event-time {
    font-size: 12px;
    color: var(--primary-color);
    font-weight: 600;
}

.event-title {
    font-weight: 500;
    color: var(--dark-color);
}

.leaderboard-item {
    display: flex;
    align-items: center;
    padding: 15px 0;
    border-bottom: 1px solid #e9ecef;
}

.leaderboard-rank {
    width: 30px;
    text-align: center;
    font-weight: 700;
    color: var(--primary-color);
}

.leaderboard-user {
    flex: 1;
    margin-left: 15px;
}

.leaderboard-name {
    font-weight: 500;
    color: var(--dark-color);
}

.leaderboard-course {
    font-size: 12px;
    color: var(--secondary-color);
}

.leaderboard-points {
    font-weight: 600;
    color: var(--success-color);
}

.forum-post {
    padding: 15px;
    background: var(--light-color);
    border-radius: var(--border-radius);
    margin-bottom: 15px;
}

.forum-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.forum-user {
    font-weight: 500;
    color: var(--primary-color);
}

.forum-time {
    font-size: 12px;
    color: var(--secondary-color);
}

.forum-content {
    color: var(--dark-color);
    line-height: 1.6;
}

.notification-panel {
    position: fixed;
    top: 80px;
    right: 20px;
    width: 350px;
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    z-index: 1000;
    display: none;
    max-height: 400px;
    overflow-y: auto;
}

.notification-header {
    padding: 20px;
    border-bottom: 1px solid #e9ecef;
    font-weight: 600;
    color: var(--dark-color);
}

.notification-item {
    padding: 15px 20px;
    border-bottom: 1px solid #e9ecef;
    cursor: pointer;
    transition: background 0.3s;
}

.notification-item:hover {
    background: var(--light-color);
}

.notification-item.unread {
    background: rgba(0,123,255,0.05);
    border-left: 4px solid var(--primary-color);
}

@media (max-width: 768px) {
    .dashboard-container {
        padding: 10px;
    }
    
    .dashboard-header {
        padding: 15px;
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .dashboard-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .stats-grid {
        grid-template-columns: 1fr 1fr;
    }
    
    .quick-actions {
        grid-template-columns: 1fr;
    }
}

.loading {
    opacity: 0.6;
    pointer-events: none;
}

.fade-in {
    animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes countUp {
    from { opacity: 0; transform: scale(0.5); }
    to { opacity: 1; transform: scale(1); }
}

.animate-count {
    animation: countUp 0.8s ease-out;
}
</style>
</head>
<body>

<div class="dashboard-container">
    <!-- Dashboard Header -->
    <div class="dashboard-header fade-in">
        <div class="user-welcome">
            <h2 id="welcomeMessage">Welcome back!</h2>
            <p id="userRole">Student Dashboard</p>
        </div>
        <div class="header-actions">
            <button class="notification-bell" onclick="toggleNotifications()">
                <i class="fa fa-bell"></i>
                <span class="notification-badge" id="notificationCount">3</span>
            </button>
            <button class="logout-btn" onclick="logout()">
                <i class="fa fa-sign-out"></i> Logout
            </button>
        </div>
    </div>

    <!-- User Statistics -->
    <div class="dashboard-card fade-in">
        <div class="card-header">
            <h3 class="card-title">Your Progress Overview</h3>
            <div class="card-icon">
                <i class="fa fa-chart-line"></i>
            </div>
        </div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value animate-count" id="coursesCount">0</div>
                <div class="stat-label">Courses Enrolled</div>
            </div>
            <div class="stat-item">
                <div class="stat-value animate-count" id="hoursCount">0</div>
                <div class="stat-label">Hours Learned</div>
            </div>
            <div class="stat-item">
                <div class="stat-value animate-count" id="certificatesCount">0</div>
                <div class="stat-label">Certificates</div>
            </div>
            <div class="stat-item">
                <div class="stat-value animate-count" id="xpPoints">0</div>
                <div class="stat-label">XP Points</div>
            </div>
            <div class="stat-item">
                <div class="stat-value animate-count" id="daysJoined">0</div>
                <div class="stat-label">Days with us</div>
            </div>
            <div class="stat-item">
                <div class="stat-value animate-count" id="currentLevel">1</div>
                <div class="stat-label">Current Level</div>
            </div>
        </div>
    </div>

    <div class="dashboard-grid">
        <!-- Course Progress -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">Course Progress</h3>
                <div class="card-icon">
                    <i class="fa fa-graduation-cap"></i>
                </div>
            </div>
            <div id="courseProgress">
                <!-- Progress items will be dynamically added -->
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">Recent Activity</h3>
                <div class="card-icon">
                    <i class="fa fa-clock"></i>
                </div>
            </div>
            <div id="recentActivity">
                <!-- Activity items will be dynamically added -->
            </div>
        </div>

        <!-- Achievement Badges -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">Achievements</h3>
                <div class="card-icon">
                    <i class="fa fa-trophy"></i>
                </div>
            </div>
            <div class="achievement-grid" id="achievementBadges">
                <!-- Achievement badges will be dynamically added -->
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">Quick Actions</h3>
                <div class="card-icon">
                    <i class="fa fa-bolt"></i>
                </div>
            </div>
            <div class="quick-actions">
                <button class="action-btn" onclick="startLearning()">
                    <i class="fa fa-play"></i><br>Continue Learning
                </button>
                <button class="action-btn" onclick="browsePrograms()">
                    <i class="fa fa-search"></i><br>Browse Programs
                </button>
                <button class="action-btn" onclick="downloadCertificate()">
                    <i class="fa fa-download"></i><br>Download Certificate
                </button>
                <button class="action-btn" onclick="joinCommunity()">
                    <i class="fa fa-users"></i><br>Join Community
                </button>
            </div>
        </div>

        <!-- Upcoming Events -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">Upcoming Events</h3>
                <div class="card-icon">
                    <i class="fa fa-calendar"></i>
                </div>
            </div>
            <div id="upcomingEvents">
                <!-- Events will be dynamically added -->
            </div>
        </div>

        <!-- Community Forum -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">Community Discussions</h3>
                <div class="card-icon">
                    <i class="fa fa-comments"></i>
                </div>
            </div>
            <div id="forumPosts">
                <!-- Forum posts will be dynamically added -->
            </div>
        </div>

        <!-- Leaderboard -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">Leaderboard</h3>
                <div class="card-icon">
                    <i class="fa fa-medal"></i>
                </div>
            </div>
            <div id="leaderboard">
                <!-- Leaderboard items will be dynamically added -->
            </div>
        </div>

        <!-- Performance Analytics -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">Learning Analytics</h3>
                <div class="card-icon">
                    <i class="fa fa-chart-bar"></i>
                </div>
            </div>
            <div style="height: 300px;">
                <canvas id="performanceChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Notification Panel -->
    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header">
            Notifications
            <button style="float: right; background: none; border: none; font-size: 18px;" onclick="toggleNotifications()">×</button>
        </div>
        <div id="notificationList">
            <!-- Notifications will be dynamically added -->
        </div>
    </div>
</div>

<script>
// Initialize Supabase
const supabaseUrl = 'https://icqzgoagqosthgipepdq.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImljcXpnb2FncW9zdGhnaXBlcGRxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwODI1NzAsImV4cCI6MjA2NDY1ODU3MH0.nzLqXrmUOmplR71fW-fumg58DiUOs_cKDqmjeuT8Yrg';
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

let currentUser = null;
let currentSession = null;
let userProfile = null;

// Check authentication state
supabase.auth.onAuthStateChange((event, session) => {
    currentSession = session;
    currentUser = session?.user ?? null;
    
    if (!currentUser) {
        window.location.href = 'getStarted.html';
    } else {
        loadUserProfile();
    }
});

// Check for existing session
supabase.auth.getSession().then(({ data: { session } }) => {
    currentSession = session;
    currentUser = session?.user ?? null;
    
    if (!currentUser) {
        window.location.href = 'getStarted.html';
    } else {
        loadUserProfile();
    }
});

async function loadUserProfile() {
    try {
        const { data, error } = await supabase
            .from('profiles')
            .select('*')
            .eq('id', currentUser.id)
            .single();
        
        if (error && error.code !== 'PGRST116') {
            console.error('Error loading profile:', error);
            return;
        }
        
        userProfile = data;
        initializeDashboard();
    } catch (error) {
        console.error('Error loading user profile:', error);
        initializeDashboard();
    }
}

function initializeDashboard() {
    updateWelcomeMessage();
    animateCounters();
    loadCourseProgress();
    loadRecentActivity();
    loadAchievements();
    loadUpcomingEvents();
    loadForumPosts();
    loadLeaderboard();
    loadNotifications();
    initializeChart();
    
    // Add some animation delays
    setTimeout(() => {
        document.querySelectorAll('.dashboard-card').forEach((card, index) => {
            setTimeout(() => {
                card.classList.add('fade-in');
            }, index * 100);
        });
    }, 200);
}

function updateWelcomeMessage() {
    const welcomeEl = document.getElementById('welcomeMessage');
    const roleEl = document.getElementById('userRole');
    
    if (userProfile && userProfile.first_name) {
        welcomeEl.textContent = `Welcome back, ${userProfile.first_name}!`;
    } else if (currentUser && currentUser.email) {
        welcomeEl.textContent = `Welcome back, ${currentUser.email.split('@')[0]}!`;
    }
    
    if (userProfile && userProfile.course) {
        roleEl.textContent = `${userProfile.course} Student`;
    } else {
        roleEl.textContent = 'Exploring Our Programs';
    }
}

function animateCounters() {
    // Simulate user data - in a real app, this would come from the database
    const userData = {
        courses: userProfile?.course ? 1 : 0,
        hours: Math.floor(Math.random() * 50) + 10,
        certificates: Math.floor(Math.random() * 3),
        xp: Math.floor(Math.random() * 1000) + 200,
        days: Math.ceil((new Date() - new Date(userProfile?.created_at || new Date())) / (1000 * 60 * 60 * 24)),
        level: Math.floor((Math.floor(Math.random() * 1000) + 200) / 100) + 1
    };
    
    animateCounter('coursesCount', userData.courses);
    animateCounter('hoursCount', userData.hours);
    animateCounter('certificatesCount', userData.certificates);
    animateCounter('xpPoints', userData.xp);
    animateCounter('daysJoined', userData.days);
    animateCounter('currentLevel', userData.level);
}

function animateCounter(elementId, target) {
    const element = document.getElementById(elementId);
    let current = 0;
    const increment = target / 50;
    const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
            current = target;
            clearInterval(timer);
        }
        element.textContent = Math.floor(current);
    }, 30);
}

function loadCourseProgress() {
    const progressContainer = document.getElementById('courseProgress');
    const courses = [
        { name: userProfile?.course || 'Web Development', progress: Math.floor(Math.random() * 80) + 20 },
        { name: 'UI/UX Design', progress: Math.floor(Math.random() * 60) + 10 },
        { name: 'Data Analysis', progress: Math.floor(Math.random() * 40) + 5 }
    ];
    
    progressContainer.innerHTML = courses.map(course => `
        <div class="progress-item">
            <div class="progress-header">
                <span class="progress-label">${course.name}</span>
                <span class="progress-percentage">${course.progress}%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${course.progress}%"></div>
            </div>
        </div>
    `).join('');
}

function loadRecentActivity() {
    const activityContainer = document.getElementById('recentActivity');
    const activities = [
        { icon: '🎓', bg: '#28a745', title: 'Completed: JavaScript Basics', time: '2 hours ago' },
        { icon: '📚', bg: '#007bff', title: 'Started: React Components', time: '5 hours ago' },
        { icon: '🏆', bg: '#ffc107', title: 'Earned: First Project Badge', time: '1 day ago' },
        { icon: '💬', bg: '#17a2b8', title: 'Posted in Web Dev Forum', time: '2 days ago' },
        { icon: '📝', bg: '#6f42c1', title: 'Submitted Assignment #3', time: '3 days ago' }
    ];
    
    activityContainer.innerHTML = activities.map(activity => `
        <div class="activity-item">
            <div class="activity-icon" style="background: ${activity.bg}">
                ${activity.icon}
            </div>
            <div class="activity-content">
                <div class="activity-title">${activity.title}</div>
                <div class="activity-time">${activity.time}</div>
            </div>
        </div>
    `).join('');
}

function loadAchievements() {
    const achievementContainer = document.getElementById('achievementBadges');
    const achievements = [
        { icon: '🏆', name: 'First Course', unlocked: true },
        { icon: '📚', name: 'Bookworm', unlocked: true },
        { icon: '🎯', name: 'Goal Setter', unlocked: true },
        { icon: '🔥', name: 'Streak Master', unlocked: false },
        { icon: '👨‍🏫', name: 'Mentor', unlocked: false },
        { icon: '🌟', name: 'All Star', unlocked: false }
    ];
    
    achievementContainer.innerHTML = achievements.map(achievement => `
        <div class="achievement-badge ${!achievement.unlocked ? 'locked' : ''}">
            <div class="achievement-icon">${achievement.icon}</div>
            <div class="achievement-name">${achievement.name}</div>
        </div>
    `).join('');
}

function loadUpcomingEvents() {
    const eventsContainer = document.getElementById('upcomingEvents');
    const events = [
        { time: '10:00 AM', title: 'Web Development Workshop', date: 'Today' },
        { time: '2:00 PM', title: 'UI/UX Design Masterclass', date: 'Tomorrow' },
        { time: '11:00 AM', title: 'Career Guidance Session', date: 'Friday' },
        { time: '3:00 PM', title: 'Project Showcase', date: 'Next Week' }
    ];
    
    eventsContainer.innerHTML = events.map(event => `
        <div class="event-item">
            <div class="event-time">${event.time} - ${event.date}</div>
            <div class="event-title">${event.title}</div>
        </div>
    `).join('');
}

function loadForumPosts() {
    const forumContainer = document.getElementById('forumPosts');
    const posts = [
        { user: 'Sarah M.', time: '5 min ago', content: 'Just finished my first React project! Thanks for all the help 🎉' },
        { user: 'Mike D.', time: '1 hour ago', content: 'Can someone explain the difference between flex and grid?' },
        { user: 'Lisa K.', time: '3 hours ago', content: 'Great workshop today on responsive design!' }
    ];
    
    forumContainer.innerHTML = posts.map(post => `
        <div class="forum-post">
            <div class="forum-header">
                <span class="forum-user">${post.user}</span>
                <span class="forum-time">${post.time}</span>
            </div>
            <div class="forum-content">${post.content}</div>
        </div>
    `).join('');
}

function loadLeaderboard() {
    const leaderboardContainer = document.getElementById('leaderboard');
    const leaders = [
        { rank: 1, name: 'Alex Johnson', course: 'Web Development', points: 2450 },
        { rank: 2, name: 'Maria Garcia', course: 'UI/UX Design', points: 2280 },
        { rank: 3, name: 'David Chen', course: 'Data Analysis', points: 2150 },
        { rank: 4, name: 'Emma Wilson', course: 'Web Development', points: 1980 },
        { rank: 5, name: 'You', course: userProfile?.course || 'Student', points: 1750 }
    ];
    
    leaderboardContainer.innerHTML = leaders.map(leader => `
        <div class="leaderboard-item">
            <div class="leaderboard-rank">#${leader.rank}</div>
            <div class="leaderboard-user">
                <div class="leaderboard-name">${leader.name}</div>
                <div class="leaderboard-course">${leader.course}</div>
            </div>
            <div class="leaderboard-points">${leader.points} XP</div>
        </div>
    `).join('');
}

function loadNotifications() {
    const notificationList = document.getElementById('notificationList');
    const notifications = [
        { title: 'Assignment Due Tomorrow', content: 'JavaScript Fundamentals Project', time: '2 hours ago', unread: true },
        { title: 'New Course Available', content: 'Advanced React Patterns', time: '5 hours ago', unread: true },
        { title: 'Weekly Progress Report', content: 'You completed 3 lessons this week!', time: '1 day ago', unread: false }
    ];
    
    notificationList.innerHTML = notifications.map(notif => `
        <div class="notification-item ${notif.unread ? 'unread' : ''}">
            <div style="font-weight: 500; margin-bottom: 5px;">${notif.title}</div>
            <div style="font-size: 14px; color: #6c757d; margin-bottom: 5px;">${notif.content}</div>
            <div style="font-size: 12px; color: #adb5bd;">${notif.time}</div>
        </div>
    `).join('');
}

function initializeChart() {
    const ctx = document.getElementById('performanceChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'],
            datasets: [{
                label: 'Hours Studied',
                data: [5, 8, 12, 7, 15, 18],
                borderColor: '#007bff',
                backgroundColor: 'rgba(0, 123, 255, 0.1)',
                tension: 0.4,
                fill: true
            }, {
                label: 'XP Gained',
                data: [120, 200, 300, 180, 350, 420],
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                tension: 0.4,
                fill: true,
                yAxisID: 'y1'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    position: 'left'
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    grid: {
                        drawOnChartArea: false,
                    }
                }
            },
            plugins: {
                legend: {
                    position: 'top'
                }
            }
        }
    });
}

// Dashboard Functions
function toggleNotifications() {
    const panel = document.getElementById('notificationPanel');
    panel.style.display = panel.style.display === 'none' || !panel.style.display ? 'block' : 'none';
}

function startLearning() {
    alert('Redirecting to your current course...');
    // In a real app, this would redirect to the learning platform
}

function browsePrograms() {
    window.location.href = 'programs.html';
}

function downloadCertificate() {
    alert('Certificate download will be available after course completion.');
    // In a real app, this would generate and download a certificate
}

function joinCommunity() {
    alert('Joining community forum...');
    // In a real app, this would redirect to the community forum
}

async function logout() {
    try {
        const { error } = await supabase.auth.signOut();
        if (error) throw error;
        window.location.href = 'getStarted.html';
    } catch (error) {
        console.error('Error logging out:', error);
    }
}

// Close notifications when clicking outside
document.addEventListener('click', function(event) {
    const panel = document.getElementById('notificationPanel');
    const button = document.querySelector('.notification-bell');
    
    if (!panel.contains(event.target) && !button.contains(event.target)) {
        panel.style.display = 'none';
    }
});
</script>

</body>
</html>
