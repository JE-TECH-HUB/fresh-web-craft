
<!doctype html>
<html class="no-js" lang="en">
<head>
<!-- Meta Tags -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Title -->
<title>Dashboard - JOEeXPRESS</title>

<!-- Favicon -->
<link rel="icon" href="images/JE Techhub logo - Copy.png">

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap" rel="stylesheet">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="css/bootstrap.min.css">
<!-- Font Awesome CSS -->
<link rel="stylesheet" href="css/font-awesome.min.css">
<!-- icofont CSS -->
<link rel="stylesheet" href="css/icofont.css">

<!-- Auth Service -->
<script src="js/authService.js"></script>

<style>
    /* Dashboard styles */
    .dashboard-container {
        padding: 30px;
    }
    
    .welcome-card {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    
    .profile-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    
    .course-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    
    .progress-bar {
        height: 20px;
        border-radius: 10px;
        margin-top: 10px;
        background-color: #e9ecef;
    }
    
    .progress-bar-fill {
        height: 100%;
        border-radius: 10px;
        background-color: #007bff;
        text-align: center;
        color: white;
        line-height: 20px;
        font-size: 12px;
    }
    
    .loader-wrapper {
        position: fixed;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.95);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        top: 0;
        left: 0;
        transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .loader {
        width: 70px;
        height: 70px;
        border: 6px solid #f3f3f3;
        border-top: 6px solid #1A76D1;
        border-radius: 50%;
        animation: spin 1.5s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .hidden {
        opacity: 0;
        visibility: hidden;
    }
</style>
</head>
<body>

<!-- Header Area -->
<header class="header">
<div class="header-inner bg-dark text-white">
<div class="container">
<div class="inner">
<div class="row">
<div class="col-lg-3 col-md-3 col-12">
<!-- Start Logo -->
<div class="logo">
<a href="index.html"><img src="images/JE Techhub logo.png" alt="Logo"></a>
</div>
<!-- End Logo -->
<!-- Mobile Nav -->
<div class="mobile-nav"></div>
<!-- End Mobile Nav -->
</div>
<div class="col-lg-7 col-md-9 col-12">
<!-- Main Menu -->
<div class="main-menu">
<nav class="navigation">
<ul class="nav menu">
<li><a href="index.html">Home</a></li>
<li><a href="index.html#about">About Us</a></li>
<li><a href="programs.html">Programs</a></li>
<li><a href="contact.html">Contact Us</a></li>
</ul>
</nav>
</div>
<!--/ End Main Menu -->
</div>
<div class="col-lg-2 col-12">
<div class="get-quote">
<a href="#" class="btn" id="logoutButton">Logout</a>
</div>
</div>
</div>
</div>
</div>
</div>
</header>
<!-- End Header Area -->

<!-- Loading Spinner -->
<div class="loader-wrapper">
    <div class="loader"></div>
</div>

<!-- Dashboard Content -->
<section class="dashboard-container">
    <div class="container">
        <div class="welcome-card">
            <h2>Welcome, <span id="userFullName">Student</span>!</h2>
            <p>This is your personal dashboard where you can track your progress and manage your profile.</p>
        </div>
        
        <div class="row">
            <div class="col-lg-4 col-md-6">
                <div class="profile-card">
                    <h3>Profile Information</h3>
                    <hr>
                    <div id="profileInfo">
                        <p><strong>First Name:</strong> <span id="userFirstName"></span></p>
                        <p><strong>Last Name:</strong> <span id="userLastName"></span></p>
                        <p><strong>Email:</strong> <span id="userEmail"></span></p>
                        <p><strong>Enrolled Course:</strong> <span id="userCourse"></span></p>
                        <p><strong>Registered On:</strong> <span id="userRegistrationDate"></span></p>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-8 col-md-6">
                <div class="course-card">
                    <h3>Course Progress</h3>
                    <hr>
                    <div id="courseProgress">
                        <p>Loading course progress...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Footer Area -->
<footer class="footer">
<div class="copyright bg-dark text-white">
<div class="container">
<div class="row">
<div class="col-12">
<div class="copyright-content text-center">
<p>&copy; 2024 JOEeXPRESS TechHub | All Rights Reserved</p>
</div>
</div>
</div>
</div>
</div>
</footer>

<script>
// Function to format dates in a more readable format
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

// Function to format course display name
function formatCourseName(courseCode) {
    switch(courseCode) {
        case 'softwareDev': return 'Software Development';
        case 'dataAnalysis': return 'Data Analysis';
        case 'videoGraphics': return 'Video Editing & Graphics Design';
        case 'forex': return 'Forex Trading';
        case 'gadgets': return 'Gadgets/Sales and Repairs';
        case 'member': return 'Member';
        default: return courseCode;
    }
}

// Handle logout
document.getElementById('logoutButton').addEventListener('click', function(e) {
    e.preventDefault();
    authService.logout();
    window.location.href = 'index.html';
});

// Load user profile data
async function loadUserProfile() {
    try {
        document.querySelector('.loader-wrapper').classList.remove('hidden');
        
        // Try to get profile from local storage first
        let userProfile = authService.getUserProfile();
        
        // If token exists but no profile, fetch it from the server
        if (authService.getToken() && !userProfile) {
            userProfile = await authService.getProfile();
        }
        
        // Redirect to login if no valid auth session
        if (!userProfile) {
            window.location.href = 'getStarted.html';
            return;
        }
        
        // Update profile information
        document.getElementById('userFullName').textContent = userProfile.firstName + ' ' + userProfile.lastName;
        document.getElementById('userFirstName').textContent = userProfile.firstName;
        document.getElementById('userLastName').textContent = userProfile.lastName;
        document.getElementById('userEmail').textContent = userProfile.email;
        document.getElementById('userCourse').textContent = formatCourseName(userProfile.course);
        document.getElementById('userRegistrationDate').textContent = formatDate(userProfile.registrationDate);
        
        // Update course progress
        const progressContainer = document.getElementById('courseProgress');
        
        if (userProfile.progress && userProfile.progress.length > 0) {
            let progressHTML = '';
            
            userProfile.progress.forEach(progress => {
                const percentComplete = (progress.completed / progress.totalModules) * 100;
                
                progressHTML += `
                    <div class="mb-4">
                        <h5>${formatCourseName(progress.course)}</h5>
                        <p>${progress.completed} of ${progress.totalModules} modules completed</p>
                        <div class="progress-bar">
                            <div class="progress-bar-fill" style="width: ${percentComplete}%">
                                ${percentComplete.toFixed(0)}%
                            </div>
                        </div>
                    </div>
                `;
            });
            
            progressContainer.innerHTML = progressHTML;
        } else {
            progressContainer.innerHTML = '<p>No course progress available.</p>';
        }
    } catch (error) {
        console.error('Error loading profile:', error);
        if (error.message.includes('token') || error.message.includes('login')) {
            // Redirect to login page if authentication issue
            window.location.href = 'getStarted.html';
        }
    } finally {
        document.querySelector('.loader-wrapper').classList.add('hidden');
    }
}

// Check authentication on page load
window.addEventListener('load', function() {
    if (!authService.isAuthenticated()) {
        window.location.href = 'getStarted.html';
        return;
    }
    
    loadUserProfile();
});
</script>

<!-- jquery Min JS -->
<script src="js/jquery.min.js"></script>
<!-- Bootstrap JS -->
<script src="js/bootstrap.min.js"></script>
</body>
</html>
